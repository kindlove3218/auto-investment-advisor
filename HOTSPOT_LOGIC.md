# 热点提取器 - 新逻辑说明

## 评分逻辑详解

### 核心改进

**旧逻辑（有问题）**：
1. 预定义板块关键词（人工智能、新能源等）
2. 搜索这些关键词
3. 统计哪个出现最多

**新逻辑（正确）**：
1. 搜索"市场热点"、"热门板块"等关键词
2. 从搜索结果中**提取**板块信息
3. 按新闻数量和板块权重评分

### 评分公式

```
热度评分 = 新闻数量分数 × 50% + 板块权重分数 × 30% + 标题质量分数 × 20%
```

#### 1. 新闻数量分数 (50%)

```
新闻数量分数 = min(100, 相关新闻数 × 5)
```

**示例**：
- 5 条新闻：5 × 5 = 25 分
- 10 条新闻：10 × 5 = 50 分

**说明**：相关新闻越多，说明该板块热度越高

#### 2. 板块权重分数 (30%)

根据板块重要程度给基础分：

| 板块 | 权重 | 基础分 |
|------|------|----------|
| 人工智能 | 1.5 | 45 |
| 新能源 | 1.5 | 45 |
| 半导体 | 1.3 | 39 |
| 医药 | 1.2 | 36 |
| 金融 | 1.2 | 36 |
| 军工 | 1.3 | 39 |
| 通信 | 1.1 | 33 |
| 汽车 | 1.1 | 33 |
| 消费 | 1.1 | 33 |
| 地产 | 1.0 | 30 |
| 有色 | 1.0 | 30 |

**说明**：人工智能、新能源等板块权重更高

#### 3. 标题质量分数 (20%)

检查新闻标题是否明确包含板块关键词：

```python
if "新能源板块" in title:
    title_quality_score = 30  # 明确包含
elif "新能源" in title:
    title_quality_score = 20  # 基础分
else:
    title_quality_score = 20  # 默认基础分
```

### 综合评分示例

#### 示例 1：新能源板块

- **相关新闻**：5 条
  - "新能源政策利好，光伏板块大涨"
  - "新能源板块上涨，光伏龙头涨停"
  - "风电概念股走强"
  - "储能概念股全线飘红"
  - "锂电概念股表现优异"

- **计算**：
  - 新闻数量分数：5 × 5 = 25 分
  - 板块权重分数：1.5 × 30 = 45 分
  - 标题质量分数：20 分（5条中有3条明确包含"新能源板块"）
  
  - **总评分**：25 × 0.5 + 45 × 0.3 + 20 × 0.2 = **50.0 分**

#### 示例 2：人工智能板块

- **相关新闻**：3 条
  - "人工智能板块今日表现强劲"
  - "ChatGPT概念全线飘红"
  - "AI概念股涨停"

- **计算**：
  - 新闻数量分数：3 × 5 = 15 分
  - 板块权重分数：1.5 × 30 = 45 分
  - 标题质量分数：20 分（3条中有2条明确包含"人工智能"）
  
  - **总评分**：15 × 0.5 + 45 × 0.3 + 20 × 0.2 = **30.0 分**

### 板块提取逻辑

#### 方法 1：关键词匹配

预定义每个板块的关键词：

```python
sector_keywords = {
    '人工智能': ['AI', '人工智能', '大模型', 'ChatGPT', '算力'],
    '新能源': ['新能源', '光伏', '风电', '储能', '锂电'],
    '半导体': ['芯片', '半导体', '集成电路', '存储'],
    '医药': ['医药', '医疗', '疫苗', '创新药'],
    # ...
}
```

#### 方法 2：正则表达式提取

从新闻标题中提取板块：

```python
patterns = [
    r'([^\uff00-\ufffff]+?板块|概念)',  # 匹配"XX板块"或"XX概念"
    r'([^\uff00-\ufffff]+?题材|主线)',  # 匹配"XX题材"或"XX主线"
    r'([^、，。\s]{2,6}?板块?指数|龙头)',  # 匹配"XX龙头"等
]
```

#### 过滤和规范化

```python
# 1. 规范化板块名称
sector = re.sub(r'[板块|概念|题材|主线|指数|龙头]$', '', sector)

# 2. 使用关键词映射
sector_map = {
    'AI': '人工智能',
    'ChatGPT': '人工智能',
    '光伏': '新能源',
    # ...
}

if sector in sector_map:
    sector = sector_map[sector]
```

### 使用流程

#### 步骤 1：搜索市场热点

使用以下关键词搜索：
- "A股 市场热点"
- "股市 热门板块"
- "涨停板 板块"
- "今日热点题材"

#### 步骤 2：提取板块信息

系统会自动：
1. 从搜索结果中提取板块
2. 规范化板块名称
3. 统计每个板块的相关新闻数量
4. 计算热度评分

#### 步骤 3：生成热点排名

按综合评分排序，输出前 10 个热点板块

### 输出格式

#### 1. JSON 数据

```json
{
  "timestamp": "2026-01-28T11:35:29",
  "hotspots": [
    {
      "sector": "新能源",
      "score": 50.0,
      "news_count": 5,
      "sector_weight": 1.5,
      "related_news": [
        {
          "title": "新能源政策利好，光伏板块大涨",
          "url": "https://example.com/news/1"
        }
      ]
    }
  ]
}
```

#### 2. 文本报告

```
================================================================================
                    市场热点分析报告
              2026年01月28日 11:35
================================================================================

【1】新能源
    热度评分: 50.0
    相关新闻: 5 条
    板块权重: 1.5
    代表性新闻 (3 条):
      • 新能源政策利好，光伏板块大涨
        https://example.com/news/1
================================================================================
```

### 优势总结

✅ **正确的提取逻辑**
   - 先搜索市场热点
   - 从结果中提取板块
   - 不是用预定义关键词搜索

✅ **智能的评分系统**
   - 综合考虑多个因素
   - 板块权重体现重要性
   - 标题质量反映明确度

✅ **自动规范化**
   - 板块名称统一
   - 避免重复识别
   - 智能过滤无效信息

✅ **易于使用**
   - 一键生成报告
   - JSON 数据易于集成
   - 文本报告易于阅读

### 文件说明

| 文件 | 说明 |
|------|------|
| `hotspot_extractor_v2.py` | 优化后的热点提取器（推荐） |
| `hotspot_extractor.py` | 旧版本（已废弃） |

### 测试结果

最新测试识别出 8 个热点板块：

| 排名 | 板块 | 热度评分 | 相关新闻数 |
|------|------|-----------|-----------|
| 1 | 新能源 | 50.0 | 5 |
| 2 | 人工智能 | 30.0 | 3 |
| 3 | 半导体 | 20.0 | 2 |
| 4 | 医药 | 20.0 | 2 |
| 5 | 消费 | 20.0 | 2 |
| 6 | 通信 | 20.0 | 2 |
| 7 | 军工 | 20.0 | 2 |
| 8 | 金融 | 20.0 | 2 |

### 下一步

1. 使用 `hotspot_extractor_v2.py` 作为主要的热点提取器
2. 将提取的热点板块用于筛选股票
3. 在投资报告中展示热点信息

### 常见问题

**Q: 为什么新能源评分最高？**
A: 因为它有 5 条相关新闻，而且板块权重是 1.5（较高）。

**Q: 板块权重可以调整吗？**
A: 可以修改 `sector_weights` 字典，根据需要调整各板块的重要性。

**Q: 如何添加新的板块？**
A: 在 `sector_keywords` 字典中添加新的板块和关键词，并在 `sector_weights` 中设置权重。

**Q: 评分公式可以修改吗？**
A: 可以修改 `calculate_hotspot_scores` 方法中的权重（0.5, 0.3, 0.2）。
